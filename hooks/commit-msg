#!/bin/sh

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# 1. Regex ki·ªÉm tra ƒë·ªãnh d·∫°ng chu·∫©n Conventional Commit v√† m√¥ t·∫£ ‚â• 10 k√Ω t·ª±
REGEX="^(feat|fix|docs|style|refactor|test|chore|perf|VNPMO)([a-zA-Z0-9_-]+)?\: .{10,}|^Merge.*"

if ! echo "$COMMIT_MSG" | grep -Eq "$REGEX"; then
  echo "‚ùå Commit message kh√¥ng ƒë√∫ng chu·∫©n Conventional Commit!"
  echo "‚úÖ V√≠ d·ª•: VNPMO-123: th√™m ch·ª©c nƒÉng ƒëƒÉng nh·∫≠p"
  echo "‚úÖ V√≠ d·ª•: feature: something"
  echo "‚úÖ V√≠ d·ª•: common: update readme"
  echo "‚úÖ V√≠ d·ª•: uat: deploy uat test"
  exit 1
fi

# 2. Ki·ªÉm tra m√¥ t·∫£ sau d·∫•u ':' kh√¥ng ƒë∆∞·ª£c qu√° chung chung
# L·∫•y ph·∫ßn m√¥ t·∫£ sau d·∫•u ':'
DESCRIPTION=$(echo "$COMMIT_MSG" | sed -E 's/^.*: //')

# Danh s√°ch m√¥ t·∫£ c·∫•m (case-insensitive)
BANNED_MESSAGES=("update code" "update logic" "fix")

for banned in "${BANNED_MESSAGES[@]}"; do
  if echo "$DESCRIPTION" | grep -iq "^$banned$"; then
    echo "‚ùå M√¥ t·∫£ commit qu√° chung chung: '$DESCRIPTION'"
    echo "üëâ Vui l√≤ng m√¥ t·∫£ c·ª• th·ªÉ h∆°n thay v√¨ d√πng: $banned"
    exit 1
  fi
done